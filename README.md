# movie.access demo app
Демо Rest-api сервис, для получения разной инфы с themoviedb.com
Должна быть осуществлена поддержка следующих запросов:
- Получение списка фильмов (с возможностью постраничного вывода,
фильтрации, и сортировки);
- Получение информации по конкретному фильму;
- Получение средней оценки по жанру. Такой запрос должен выполняться в
асинхронном режиме, то есть в ответ на такой запрос клиент сразу получает
ответ о том, что подсчёт начался. Затем клиент может узнавать о ходе
подсчёта, в ответ ему должен возвращаться процент обработанной
информации, либо результат подсчёта, то есть средняя оценка. В случае
нескольких параллельных запросов, на подсчёт средней оценки для одного
жанра, должен выполняться только один подсчёт.
# как запустить
mvn spring-boot:run
или
./production.sh build (в корне проекта)
# Где по тестить как работает (но это не точно)
194.87.234.90:8080

# Документация API 
## Документация OpenAPI Spec
http://localhost:8080/v2/api-docs

## Swagger UI, документация, тестирование запросов
http://localhost:8080/swagger-ui.html

# API для взаимодействия
## Полученние ответа в формате JSON или XML
Для того что управлять форматом ответа, необходимо указать значение 
для заголовка Accept.

application/json - для получения ответа в json

application/xml - для получение ответа xml

Применимо ко всем ниже описаным запросам.

## получение информации по определенному фильму
При выполнении этого запроса происходит обращение к в themoviedb.
В результате чего извлекается подробная информация о
фильме (подробнее о том какие данные отдает метод можно прочесть здесь https://developers.themoviedb.org/3/movies/get-movie-details)
В результате выполнения запроса извлекается только часть данных(подробнее см класс {@link MovieInfo}).
Для того что бы добавить извление дополнительной информации достаточно добавить необходимые поля в класс {@link MovieInfo}.

### url
GET /movie/info
### параметры запроса
movieId : integer (id фильма, информацию по которому необходимо получить)
### Пример запроса
194.87.234.90:8080/movie/info?movieId=418457
### что то пошло нет так
Ошибка может возникнуть если указать не существующий id фильма.
В результате запрос вернет информацию об этом, переправляя данные с themoviedb

## получение списка фильмов, удволетворяющего некоторым критериям,с возможностью сортировки
При выполнении этого запроса происходит обращения к внешнему сервису, 
В результате чего мы получаем список фильмов, с краткой информацией о фильме,
 (подробнее см класс {@link MovieList})удволетворяющих некому критерию.
По сути запрос, просто перенаправляет получаемые критерии поиска на внешний сервис,
который берет на себя их обработку.
При доработке сервиса, при текущей архитектуре, можно легко внедрить любую
дополнительную обработку получаемых данных.
### url
GET /movie/list
### параметры запроса
Любой из параметров описанных в документации themoviedb "GET /discover/movie"
https://developers.themoviedb.org/3/discover/movie-discover
За исключением api_key
### Пример запроса
GET 194.87.234.90:8080/movie/list?page=1&year=2016&sort_by=popularity.asc
### что то пошло нет так
Если не передать ни одного параметра, сервер возвращает 400 код ошибки.
Если переданные не корректные данные, запрос будет обработан, будет возвращенна
инфа о ошибке.

## Средняя оценка по жанру
Предоставляет информацию о средней оценки фильмов по жанру.
Если необходимой информации нет, инициирует, процесс выполнения подсчтета.
А пользователь получает объект, который содержит два поля:
- средняя оценка
- процент готовности
При первом запросе, оба поля будут содержать нули.
При последующих запросах, значение процента готовности будет обновляется, отражая то, сколько 
процентов данных обработанно. 
О готовности информации будет свидетельствовать число больше нуля в поле средней оценки и 
в поле процент готовности значение 100.0
В случае возникновения ошибки при процессе подсчета(например указан неверный id жанра)
оба поля примут значение NaN.
### url
GET /movie/average
### параметры запроса
genreId : integer
id жанров можно узнуть тут https://api.themoviedb.org/3/genre/movie/list?api_key=72b56103e43843412a992a8d64bf96e9
### пример запроса
GET 194.87.234.90:8080/movie/average?genreId=28
### что то пошло нет так
Ошибка может произойти при некорректном параметре, а также если передаваемый id жанра не существует.

## Подход к тестированию системы в не очень идеальной вселенной;)
Тестирование полученной системы не требует, какой либо специфики.

В данном случаи, компоннеты отвечающие за взаимодействие с themoviedb, могут без проблем взаимодействовать с
сервисом в рамках тестов. Однако, с целью ускорения работы тестов, можно подменять httpclient mock обьектом.

Контроллеры не содержат сложной логики(по сути, только передают данные, другим компонентам) и их тестирование, 
и достаточно проверить их реакцию на некорректные входные данные, а также то что они не искажют результаты получаеммые от других компонентов.

Бизнес логика требует тестирование логики работы самих компонентов.

И в идеале, юнит тесты, должны покрывать большую часть (если не всю) возможных проблем.
Однако в рамках интеграционных тестов, впервую очередь требуется тестирование взаимедействия компонентов взаимодействиющие с
api themovidb и менеджеров управлющих их работой.
Так при текущей реализации, контроллеры, не содержат сложную логику, и тестирования их взаимодействие с менеджерами скорей
не нужно, чем нужно.
В идеальной вселенной, тестами можно обложить все начиная с гетреов и сеттеров, и заканчивая взаимодействием всех возможных
комбинаций модулей, но данном случае, при ограниченном времени, и не критичести сбоев в системе, тестирования требуют только 
основные компоненты, а также сложные взаимодействия между ними. 

---
V.V.V.V.V.
